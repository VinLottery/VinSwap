<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tra cứu Hash Polygon</title>
</head>
<body>
    <h1>Tra cứu Hash Gần 10:00 UTC</h1>
    <label for="date">Chọn ngày (YYYY-MM-DD):</label>
    <input type="date" id="date">
    <button id="fetch">Tra cứu</button>
    <div id="result"></div>

    <script>
        async function fetchHash(date) {
            // Tính timestamp cho 10:00 UTC ngày được chọn
            const timestamp = Math.floor(new Date(date + 'T10:00:00Z').getTime() / 1000);

            try {
                // Gọi API Polygonscan để lấy block gần nhất trước timestamp
                const response = await fetch(`https://api.polygonscan.com/api?module=block&action=getblocknobytime&timestamp=${timestamp}&closest=before&apikey=YourApiKey`);
                const data = await response.json();

                if (!data || data.status !== "1") {
                    document.getElementById("result").innerHTML = `<p>Không tìm thấy block cho ngày này. Vui lòng thử lại.</p>`;
                    return;
                }

                const blockNumber = data.result;

                // Gọi API để lấy thông tin chi tiết block
                const blockResponse = await fetch(`https://api.polygonscan.com/api?module=proxy&action=eth_getBlockByNumber&tag=${parseInt(blockNumber).toString(16)}&boolean=true&apikey=YourApiKey`);
                const blockData = await blockResponse.json();

                if (!blockData.result) {
                    document.getElementById("result").innerHTML = `<p>Không lấy được thông tin block.</p>`;
                    return;
                }

                const blockHash = blockData.result.hash;

                // Tính bộ số từ hash
                const numbers = [];
                for (let i = 0; i < 10; i += 2) {
                    const hexPair = blockHash.slice(2 + i, 4 + i);
                    const decimal = parseInt(hexPair, 16);
                    numbers.push((decimal % 70) + 1); // Số từ 1-70
                }
                const specialNumber = (parseInt(blockHash.slice(-2), 16) % 25) + 1; // Số từ 1-25

                // Hiển thị kết quả
                document.getElementById("result").innerHTML = `
                    <p><strong>Block Number:</strong> ${blockNumber}</p>
                    <p><strong>Block Hash:</strong> ${blockHash}</p>
                    <p><strong>Jackpot Numbers:</strong> ${numbers.slice(0, 5).join(", ")}; ${specialNumber}</p>
                    <p><strong>Link:</strong> <a href="https://polygonscan.com/block/${blockNumber}" target="_blank">Xem trên Polygonscan</a></p>
                `;
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById("result").innerHTML = `<p>Đã xảy ra lỗi khi lấy thông tin. Vui lòng thử lại.</p>`;
            }
        }

        document.getElementById("fetch").addEventListener("click", () => {
            const date = document.getElementById("date").value;
            if (!date) {
                alert("Vui lòng chọn ngày!");
                return;
            }
            fetchHash(date);
        });
    </script>
</body>
</html>
